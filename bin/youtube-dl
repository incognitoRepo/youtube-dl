#!/usr/bin/env python3
import youtube_dl
import hunter
from youtube_dl.hunterconfig import QueryConfig
from hunter.tracer import Tracer
from pathlib import Path
from pdb import set_trace as st
import os
from tblib import pickling_support
pickling_support.install()
import pickle, sys

if __name__ == '__main__':
  qc = QueryConfig()
  qcfg = [qc.eventpickle()]#,qc.noloop()]
  tracer = Tracer()
  for query,actions,outputs,filenames,write_func,epdf_pklpth in qcfg:
    tracer.trace(query)
    youtube_dl.main()
    write_func()
    action = actions[0]
    for e in action.evt_dcts:
      try:
        pickle.dumps(e,pickle.HIGHEST_PROTOCOL)
      except:
        st()
    with open('evts.pkl','wb') as f:
      pickle.dump(action.evt_dcts,f,pickle.HIGHEST_PROTOCOL)
    with open('evts.pkl','rb') as f:
      evts = pickle.load(f)
